
业务保障流程主要包括问题的发现、定位、快速处理、解决等四个步骤，每部分内部可以通过多种手段增强自动化能力，各部分之间建立信息流转，从而压缩保障时间，不断提高保障效率。

### _预防_

在业务的长耗时、重依赖节点处利用**快速失败框架**防止依赖方出现问题时造成雪崩。

### _发现_

发现业务问题，主要通过**实时监控报警、离线分析预警**等手段。实时监控报警需要覆盖视图、声音、邮件、微博、短信等多种渠道让运维和研发尽可能早的发现线上此时此刻接口提供服务异常、流量异常等；离线分析预警手段需要对历史监控数据进行分析比对，尽可能早的发现线上服务接口在服务压力、报错量、耗时等方面，服务资源在负载、性能方面的变化趋势。

####  实时接口监控报警


1. 直接手段
实时发现线上此时此刻接口提供服务异常

	1. 探测式报警
		* 接口-服务异常

	2. Grafana、Cni监控报警
		* 接口-2xx, 4xx， 5xx, 耗时
		* RPC-请求量，错误量，耗时
		* 资源-请求量，错误量，耗时
	
	3. 突变报警
		* 接口-2xx, 4xx， 5xx, 耗时

	4. 外围监控
		* RPC-down，up
		* 硬件-load，memory，swap，cpu....

	5. SinaWatch
		* 硬件-load，memory，swap，cpu, 网络...

2. 增强

	1. Grafana自动生成
		* 根据服务识别当前可支持监控项目（涵盖接口、链路、资源）
		* 针对一个业务自动生成Grafana，涵盖接口的调用情况、业务链路上各个节点的依赖调用情况和对资源的调用情况
	
	2. Grafana声音监控
		* 为Grafana提供实时声音报警（基于阈值）
		
	3. 灰度预览自动监控
		* 接入上线系统，业务预览、灰度时自动生成针对IP的接口监控（4xx,5xx,cost）
	
#### 离线分析预警

1. 趋势比对
按日(周、月)比对指标变化趋势

	* 接口调用量
	* 接口耗时
	
2. 邮件聚合分析
按日(周、月)分类统计报警邮件

	* 哪类报警本日(周、月)尚未处理
	* 哪些类型(内容)的报警居高不下
	* 哪些类型(内容)的报警有上升趋势
	* 根据预设 针对重点报警聚合达到次数升级报警手段

### _定位_

定位问题遵循 **面 > 线 > 点** 的顺序，依靠报警信息可以初步定位问题业务(面)，依靠完整的Grafana监控视图可以初步定位问题链路(接口、依赖、资源)，依靠日志具体定为问题位置(点)。

1. 日志规范化

	* 添加必要的链路日志(watch-man)
		* 减少业务入侵
		* 快速从业务降级
	
1. 异常日志聚合
按照时长间隔拉取并按照错误类型聚合业务日志中WARN、ERROR日志(统称为“异常日志”)

	* 各个类型异常日志的数量
	* 异常日志按数量排名
	* 某类异常日志近期的增长曲线
	* 动态拉取异常日志上下文

2. 日志快速检索

	* wtool集成常用检索功能模板

